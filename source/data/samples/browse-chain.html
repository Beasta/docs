<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>BlockCypher Reference: Browse the Block Chain</title>
		<link href="/stylesheets/samples.css" rel="stylesheet" type="text/css" media="screen">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	</head>

	<div class="content">
		<h1>Browse the Block Chain</h1>
		<p>In this example, we retrieve the last 10 block from the Bitcoin block chain and render a summary page. We start with the chain property to get the URL of the latest block. We then use the prev_block_url to load the previous, hence traversing the block chain back block by block.</p>
		<p>From the command line, we retrieve the latest block using the <a href="http://curl.haxx.se/">curl</a> and <a href="https://github.com/zpoley/json-command">json</a> commands:</p>
		<pre class="highlight shell"><code>$ curl -s https://api.blockcypher.com/v1/btc/main | json latest_url | xargs curl -s</code></pre>

		<p>Here we use the json command to extract the latest_url property from the chain and pass it to curl using xargs (invokes a command passing the stdin parameters). This can be chained further to go one block back:</p>
		<pre class="highlight shell"><code>$ curl -s https://api.blockcypher.com/v1/btc/main | json latest_url | xargs curl -s | json prev_block_url | xargs curl -s</code></pre>

		<p>We can continue chaining calls, but it quickly gets very long. Here's a short Javascript program which can be run in the browser to do the same thing using JQuery:</p>

		<pre class="highlight javascript" data-src="/data/samples/js/3-latest-blocks.js">
			<code>
// Displays the block, for now we just do an alert to show the block's height.
function showBlock(block) {
  alert(block.height);
}

// Gets the JSON data returned by the previous JQuery.get, parse it and returns a
// new promise to get the next block.
function printAndGetNext(block) {
  showBlock(block);
  return $.get(block.prev_block_url);
}

// First gets the blockchain data using JQuery.get, parses it and returns a promise to get
// the latest block. We queue several then() calls right after to get each block one after
// another and display them.
$.get("http://api.blockcypher.com/v1/btc/main").then(function(chain) {
  return $.get(chain.latest_url);
}).then(printAndGetNext).then(printAndGetNext).then(printAndGetNext);
			</code>
		</pre>
		<button class="tryme btn btn-primary" type="button">Try me!</button>

		<p>The above JQuery.get calls our APIs and utilizes the URLs returned by every call. We allow cross-origin resource sharing which enables requests from your domain.</p>
		<p>To improve on the above code, we add more details and a loop to get 10 blocks, instead of 3:</p>

		<pre class="highlight javascript" data-src="/data/samples/js/10-latest-blocks.js"></pre>
		<button class="tryme btn btn-primary" type="button" id="10-latest-blocks">Try me!</button>


		<script src="/data/samples/js/bitcoinjs-min.js"></script>
		<script>
			$('button.tryme').click(function(e) {
				eval($(this).prev().children().text());
			});
		</script>
	</div>

</html>
